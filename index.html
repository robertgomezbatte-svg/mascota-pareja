<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mascota pareja</title>
  <style>
    body{font-family:system-ui;margin:20px;max-width:520px}
    .bar{height:14px;background:#eee;border-radius:8px;overflow:hidden;margin:6px 0 14px}
    .fill{height:100%;background:#444;width:0%}
    button{padding:10px 12px;margin:6px 6px 0 0}
    input{padding:10px;width:100%;margin:6px 0 10px}
    .small{opacity:.8;font-size:14px}
    #petStage{
  margin: 12px 0 16px;
  padding: 14px 12px;
  border: 1px solid #ddd;
  border-radius: 14px;
}
#pet{
  font-size: 72px;
  line-height: 1;
  display: inline-block;
  transform-origin: 50% 100%;
  user-select: none;
}
#petBubble{ margin-top: 8px; min-height: 18px; }

/* Animaciones */
@keyframes bounce {
  0%,100% { transform: translateY(0) scale(1); }
  50%     { transform: translateY(-10px) scale(1.02); }
}
@keyframes wiggle {
  0%,100% { transform: rotate(0deg); }
  25%     { transform: rotate(-6deg); }
  75%     { transform: rotate(6deg); }
}
@keyframes sleep {
  0%,100% { transform: translateY(0) scale(1); opacity: 1; }
  50%     { transform: translateY(2px) scale(0.98); opacity: 0.85; }
}
@keyframes sad {
  0%,100% { transform: translateY(0) rotate(0deg); }
  50%     { transform: translateY(6px) rotate(-2deg); }
}

.idle { animation: bounce 1.6s infinite; }
.play { animation: wiggle 0.6s ease-in-out 3; }
.nap  { animation: sleep 1.8s infinite; }
.sad  { animation: sad 1.4s infinite; }

  </style>
</head>
<body>
  <h1>üêæ Mascota</h1>
<div id="petStage">
  <div id="pet" class="idle" aria-label="mascota">üê∂</div>
  <div id="petBubble" class="small"></div>
</div>

  <label>Tu nombre (para registrar qui√©n hizo la acci√≥n)</label>
  <input id="who" placeholder="Ej: Alex" />

  <label>Nombre de la mascota</label>
  <input id="petName" />

  <div>
    <div>Hambre: <span id="HungerTxt"></span></div>
    <div class="bar"><div class="fill" id="HungerBar"></div></div>

    <div>Felicidad: <span id="happyTxt"></span></div>
    <div class="bar"><div class="fill" id="happyBar"></div></div>

    <div>Energ√≠a: <span id="EnergyTxt"></span></div>
    <div class="bar"><div class="fill" id="EnergyBar"></div></div>
  </div>

  <button onclick="act('feed')">üçé Alimentar</button>
  <button onclick="act('play')">üéæ Jugar</button>
  <button onclick="act('sleep')">üò¥ Dormir</button>
  <button onclick="saveName()">üíæ Guardar nombre</button>

  <p class="small">
    √öltima acci√≥n: <b id="LastAction"></b> ‚Äî por <b id="LastBy"></b>
  </p>

  <!-- Firebase (sin instalar nada) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, onSnapshot, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // 1) PEGA AQU√ç tu firebaseConfig (del paso 2)
    const firebaseConfig = {
      // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAl-_NVNdvBSq08C9d5soYAi-K20-2zM8E",
  authDomain: "mascota-pareja.firebaseapp.com",
  projectId: "mascota-pareja",
  storageBucket: "mascota-pareja.firebasestorage.app",
  messagingSenderId: "139071919542",
  appId: "1:139071919542:web:3687d6b75f27040d2e5d17",
  measurementId: "G-J0CL7GXBLD"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const petRef = doc(db, "pets", "shared");

    function clamp(n){ return Math.max(0, Math.min(100, n)); }

    // 2) Escuchar cambios en tiempo real (los 2 m√≥viles ver√°n lo mismo)
    onSnapshotfunction setPetMood(p){
  const petEl = document.getElementById("pet");
  const bubble = document.getElementById("petBubble");

  petEl.className = "idle";

  const Hunger = Number(p.Hunger ?? 0);
  const Happiness = Number(p.Happiness ?? 0);
  const Energy = Number(p.Energy ?? 0);

  if (Energy <= 20) { petEl.className = "nap"; bubble.textContent = "Tengo sue√±o‚Ä¶"; return; }
  if (Hunger <= 20 || Happiness <= 20) { petEl.className = "sad"; bubble.textContent = "No me siento muy bien‚Ä¶"; return; }

  bubble.textContent = "¬°Estoy bien!";
}

onSnapshot(
  petRef,
  (snap) => {
    if (!snap.exists()) {
      document.getElementById("petBubble").textContent = "No existe pets/shared en Firestore.";
      return;
    }

    const p = snap.data();
    document.getElementById("petName").value = p.name ?? "";

    document.getElementById("HungerTxt").textContent = p.Hunger ?? 0;
    document.getElementById("happyTxt").textContent = p.Happiness ?? 0;
    document.getElementById("EnergyTxt").textContent = p.Energy ?? 0;

    document.getElementById("HungerBar").style.width = (p.Hunger ?? 0) + "%";
    document.getElementById("happyBar").style.width = (p.Happiness ?? 0) + "%";
    document.getElementById("EnergyBar").style.width = (p.Energy ?? 0) + "%";

    document.getElementById("LastAction").textContent = p.LastAction ?? "-";
    document.getElementById("LastBy").textContent = p.LastBy ?? "-";

    setPetMood(p);
  },
  (err) => {
    document.getElementById("petBubble").textContent = "Error Firestore: " + err.message;
  }
);


  // Reset clases
  petEl.className = "idle";

  const Hunger = p.Hunger ?? 0;
  const Happiness = p.Happiness ?? 0;
  const Energy = p.Energy ?? 0;

  // Reglas simples de ‚Äúhumor‚Äù
  if (Energy <= 20) { petEl.className = "nap"; bubble.textContent = "Tengo sue√±o‚Ä¶"; return; }
  if (Hunger <= 20 || Happiness <= 20) { petEl.className = "sad"; bubble.textContent = "No me siento muy bien‚Ä¶"; return; }

  bubble.textContent = "¬°Estoy bien!";
}
);

    // 3) Acciones
    window.act = async (type) => {
      const who = document.getElementById("who").value.trim() || "Alguien";
      // Leemos el estado actual desde la UI (ya sincronizada)
      const Hunger = Number(document.getElementById("HungerTxt").textContent || 0);
      const Happiness = Number(document.getElementById("happyTxt").textContent || 0);
      const Energy = Number(document.getElementById("EnergyTxt").textContent || 0);

      let nh=Hunger, nha=Happiness, ne=Energy, actionText="";

      if(type==="feed"){ nh = clamp(Hunger + 20); ne = clamp(Energy - 5); actionText="Alimentar"; }
      if(type==="play"){ nha = clamp(Happiness + 20); ne = clamp(Energy - 15); nh = clamp(Hunger - 5); actionText="Jugar"; }
      if(type==="sleep"){ ne = clamp(Energy + 25); nh = clamp(Hunger - 10); actionText="Dormir"; }
// Animaci√≥n inmediata local al pulsar
const petEl = document.getElementById("pet");
if(type==="play"){ petEl.className = "play"; }

      await updateDoc(petRef, {
        Hunger: nh,
        Happiness: nha,
        Energy: ne,
        LastAction: actionText,
        LastBy: who,
        updatedAt: serverTimestamp()
      });
    };

    window.saveName = async () => {
      const name = document.getElementById("petName").value.trim() || "Mascota";
      await updateDoc(petRef, { name });
    };
  </script>
</body>
</html>
